:name: LiteX SD card-based Linux rootfs demo
:description: This script runs Linux on LiteX/VexRiscv with the rootfs loaded form the SD card.

$name?="litex-vexriscv"
$rootfs?=@https://dl.antmicro.com/projects/renode/riscv32-buildroot--busybox-rootfs.ext4.image-s_67108864-cd5badff81b32092c010d683c471821d4ea99af6
$device_tree?=@https://dl.antmicro.com/projects/renode/litex_vexriscv-sdcard--rootfs_from_sdcard-rv32.dtb-s_2096-7ff4845287ba6298612e3db510c66da6d9c46075
$kernel?=@https://dl.antmicro.com/projects/renode/litex_vexriscv-sdcard--kernel.bin-s_5779444-35ab9df3c7269c9efbbba50a2d88acebf0ba8f41
$emulator?=@https://dl.antmicro.com/projects/renode/litex_vexriscv-sdcard--emulator.bin-s_2992-b37cf5dc3e72d990ca44b12228edbe2d54faaea8

using sysbus
mach create $name

machine LoadPlatformDescription @platforms/cpus/litex_linux_vexriscv_sdcard.repl
machine SdCardFromFile $rootfs mmc_controller False

showAnalyzer uart

macro reset
"""
    sysbus LoadBinary $kernel 0x40000000
    sysbus LoadBinary $device_tree 0x41000000
    sysbus LoadBinary $emulator 0x41100000
    cpu PC 0x41100000
"""
runMacro $reset
